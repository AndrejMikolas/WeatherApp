openapi: 3.1.0
info:
  title: OAuth 2.0 Benu API
  version: '1.1.0'
  description: This document describes the API endpoints for an RFC-compliant OAuth 2.0 server.
  contact:
    name: Benu e-comm
    email: a.team-eshop@benu.cz
    url: 'https://www.benu.cz'
servers:
  - url: https://{prodApiUrl}/api/auth
    description: Production
    variables:
      prodApiUrl:
        default: benu.cz
        enum:
          - www.benu.cz
          - www.benulekaren.sk
          - benu.rs
          - www.helpnet.ro
          - www.benunapredpis.cz
  - url: https://{prodWarmupApiUrl}/api/auth
    description: Production Warmup
    variables:
      prodWarmupApiUrl:
        default: warmup.benu.cz
        enum:
          - warmup.benu.cz
          - warmup.benulekaren.sk
          - warmup.benu.rs
          - warmup.helpnet.ro
          - warmup.benunapredpis.cz
  - url: https://{stagingApiUrl}/api/auth
    description: Test
    variables:
      stagingApiUrl:
        default: cz.benu.test
        enum:
          - cz.benu.test
          - rs.benu.test
          - ro.benu.test
  - url: http://{localApiUrl}/api/auth
    description: Localhost
    variables:
      localApiUrl:
        default: cz.benu.l:8081
        enum:
          - cz.benu.l:8081
          - sk.benu.l:8081
          - rs.benu.l:8081
          - ro.benu.l:8081
          - czrx.benu.l:8081
paths:
  /token:
    post:
      summary: Obtain OAuth2 Token
      description: |
        This endpoint follows the OAuth 2.0 specification for obtaining an access token.
        Client authentication (client_id and client_secret) MUST be provided as parameters in the form-encoded request body.
        
        It supports two grant types:
        1.  **client_credentials**: For machine-to-machine authentication.
        2.  **refresh_token**: To obtain a new access token using a refresh token.
      tags:
        - Authentication
      requestBody:
        description: The grant type and required parameters (form-encoded).
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              oneOf:
                - $ref: '#/components/schemas/ClientCredentialsRequest'
                - $ref: '#/components/schemas/RefreshTokenRequest'
            examples:
              clientCredentialsRequest:
                summary: Client Credentials Grant Request
                description: "Example request for the `client_credentials` grant type, used for M2M authentication."
                value:
                  grant_type: "client_credentials"
                  client_id: "m2m-client-123"
                  client_secret: "a-very-secure-client-secret-for-m2m"
              refreshTokenRequest:
                summary: Refresh Token Grant Request
                description: "Example request to get a new access token using a `refresh_token`."
                value:
                  grant_type: "refresh_token"
                  refresh_token: "rt_def456_a_long_and_secure_refresh_token"
                  client_id: "webapp-client-789"
                  client_secret: "a-secure-secret-for-the-webapp"
      responses:
        '200':
          description: Access token issued successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              examples:
                clientCredentialsResponse:
                  summary: Success Response for Client Credentials
                  description: "A successful token response for a `client_credentials` grant. Note that a `refresh_token` is typically not issued for this grant type."
                  value:
                    access_token: "at_abc_an_access_token_for_the_service"
                    token_type: "Bearer"
                    expires_in: 3600
                refreshTokenResponse:
                  summary: Success Response for Refresh Token
                  description: "A successful token response after using a `refresh_token`. A new `refresh_token` may optionally be returned."
                  value:
                    access_token: "at_xyz_a_new_access_token"
                    token_type: "Bearer"
                    expires_in: 3600
                    refresh_token: "rt_ghi_a_new_rotated_refresh_token"
        '400':
          description: Bad Request. The grant type is invalid, or a required parameter is missing or malformed (e.g., the refresh token).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
              examples:
                invalidGrantError:
                  summary: Invalid Grant Error
                  description: "Error returned when the provided `refresh_token` is expired, revoked, or malformed."
                  value:
                    error: "invalid_grant"
                    error_description: "The provided refresh token is invalid or has expired."
        '401':
          description: Unauthorized. Client authentication failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
              examples:
                invalidClientError:
                  summary: Invalid Client Error
                  description: "Error returned when the `client_id` or `client_secret` are incorrect."
                  value:
                    error: "invalid_client"
                    error_description: "Client authentication failed."

components:
  schemas:
    ClientCredentialsRequest:
      type: object
      description: Schema for the client_credentials grant request with body authentication.
      properties:
        grant_type:
          type: string
          description: The grant type must be set to 'client_credentials'.
          const: client_credentials
        client_id:
          type: string
          description: The client's unique identifier.
        client_secret:
          type: string
          description: The client's secret.
      required:
        - grant_type
        - client_id
        - client_secret

    RefreshTokenRequest:
      type: object
      description: Schema for the refresh_token grant request with body authentication.
      properties:
        grant_type:
          type: string
          description: The grant type must be set to 'refresh_token'.
          const: refresh_token
        refresh_token:
          type: string
          description: The refresh token issued to the client.
        client_id:
          type: string
          description: The client's unique identifier.
        client_secret:
          type: string
          description: The client's secret.
      required:
        - grant_type
        - refresh_token
        - client_id
        - client_secret

    TokenResponse:
      type: object
      description: The response payload containing the access token.
      properties:
        access_token:
          type: string
          description: The issued access token.
        token_type:
          type: string
          description: The type of token issued, typically "Bearer".
        expires_in:
          type: integer
          format: int32
          description: The lifetime in seconds of the access token.
        refresh_token:
          type: string
          description: "(Optional) A new refresh token. Typically returned when using the `refresh_token` grant."
      required:
        - access_token
        - token_type
        - expires_in

    OAuthError:
      type: object
      description: Standard OAuth 2.0 error response.
      properties:
        error:
          type: string
          description: A single error code.
        error_description:
          type: [ "string", "null" ]
          description: A human-readable explanation of the error. This field is optional.
      required:
        - error
